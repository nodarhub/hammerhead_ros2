# Introduction

The point clouds that Hammerhead generates can sometimes overwhelm the network due to the bandwidths involved.
In such cases, we advise setting Hammerhead to publish `PointCloudSoup` messages from the `hammerhead_msgs` package.
From this message type, one can losslessly reconstruct XYZRGB point clouds,
while using a fraction of the bandwidth of `PointCloud2` messages.

## Purpose

This example demonstrates how to subscribe to `PointCloudSoup` messages, generate downsampled `PointCloud2` instances,
and then publish those `PointCloud2` messages on the `nodar/point_cloud` topic.
We provide this example as an introduction to the `PointCloudSoup` type.
We advise against publishing `PointCloud2` messages like this in production without
considering the bandwidth required.
For this reason, the current example downsamples the point clouds by a factor of 10
before republishing as `PointCloud2` messages.

## Quick Start

Place this example along with the `hammerhead_msgs` folder in a ROS2 workspace. That is, your directory structure should
look like

    hammerhead_ros2_ws/
        src/
            hammerhead_msgs/
            point_cloud_generator_py/

From the root of the workspace, build the message types and this example:

    cd hammerhead_ros2_ws
    colcon build

Finally, register the packages with ROS2, and run the point cloud generator

    . install/setup.bash
    ros2 run point_cloud_generator_py point_cloud_generator_py 

Internally, the `point_cloud_generator_py` example subscribes to the `nodar/point_cloud_soup` topic generated by
hammerhead, and publishes downsampled `PointCloud2` messages on the `nodar/point_cloud` topic which you can visualize in
`rviz2` and other programs.

## ROS2 DDS tuning

Look at [this](https://docs.ros.org/en/rolling/How-To-Guides/DDS-tuning.html) page for information on setting network 
interface parameters to improve frame rates of incoming data.
Setting `net.ipv4.ipfrag_time=3` and `net.ipv4.ipfrag_high_thresh=536870912` seems to work well, but might need to be
adjusted based on your setup.