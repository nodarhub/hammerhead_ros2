# Introduction

Hammerhead does not currently publish point clouds over a ROS2 interface due to the amount of bandwidth
that would require. Instead, hammerhead publishes the `PointCloudSoup` message type defined the `hammerhead_msgs`
package on the `nodar/point_cloud_soup` topic. From this message type, one can losslessly reconstruct XYZRGB point
clouds, while using a fraction of the
bandwidth of `PointCloud2` messages.

## Purpose

This example demonstrates how to subscribe to `PointCloudSoup` messages, generate downsampled `PointCloud2` instances,
and then publish those `PointCloud2`
messages on the `nodar/point_cloud` topic. We provide this example as an introduction to
the `PointCloudSoup` type. We advise against publishing `PointCloud2` messages like this in production code without
properly considering the bandwidth required. For this reason, the current example downsamples the point clouds by a
factor of
10 before republishing as `PointCloud2` messages.

## Quick Start

Place this example along with the `hammerhead_msgs` folder in a ROS2 workspace. That is, your directory structure should
look like

    hammerhead_ros2_ws/
        src/
            hammerhead_msgs/
            point_cloud_generator/

From the root of the workspace, build the message types and this example:

    cd hammerhead_ros2_ws
    colcon build

Finally, register the packages with ROS2, and run the point cloud generator

    . install/setup.bash
    ros2 run point_cloud_generator point_cloud_generator 

Internally, the `point_cloud_generator` subscribes to the `nodar/point_cloud_soup` topic generated by hammerhead, and
publishes downsampled `PointCloud2` messages on the `nodar/point_cloud` which you can visualize in `rviz2` and other
programs.  

## ROS2 DDS tuning
Look at [this](https://docs.ros.org/en/rolling/How-To-Guides/DDS-tuning.html) page for information on setting network interface parameters to improve framer rates of incoming data. 
Setting `net.ipv4.ipfrag_time=3` and `net.ipv4.ipfrag_high_thresh=536870912` seems to work well, but might need to be adjusted based on your setup.
